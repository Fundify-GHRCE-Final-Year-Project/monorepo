# Docker Containers
# 1. Foundry & Anvil
# 2. MongoDB
# 3. Indexer
# 4. Website

services:
  ethereum:
    image: ghcr.io/foundry-rs/foundry:latest
    ports:
      - "8545:8545"
    networks:
      - fundify-net
    entrypoint:
      - "anvil"
      - "--host"
      - "0.0.0.0"
      - "--port"
      - "8545"
      - "--chain-id"
      - "1"

  contract:
    build:
      context: ./contract
      dockerfile: Dockerfile
    networks:
      - fundify-net
    environment:
      - RPC_URL=http://ethereum:8545
      - USER1_PUBLIC_KEY=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
      - USER1_PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
      - USER2_PUBLIC_KEY=0x70997970C51812dc3A010C7d01b50e0d17dc79C8
      - USER2_PRIVATE_KEY=0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d
      - USER3_PUBLIC_KEY=0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
      - USER3_PRIVATE_KEY=0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a
      - USER4_PUBLIC_KEY=0x90F79bf6EB2c4f870365E785982E1f101E93b906
      - USER4_PRIVATE_KEY=0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6
      - USER5_PUBLIC_KEY=0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65
      - USER5_PRIVATE_KEY=0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a
      - NEW_USER_PUBLIC_KEY=0xa0Ee7A142d267C1f36714E4a8F75612F20a79720
      - NEW_USER_PRIVATE_KEY=0x2a871d0798f97d79848a013d4936a73bf4cc922c825d33c1cf7073dff6d409c6
    depends_on:
      - ethereum

  mongodb:
    image: mongo:latest
    ports:
      - "27017:27017"
    networks:
      - fundify-net
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin

  indexer:
    build:
      context: .
      dockerfile: apps/indexer/Dockerfile
    networks:
      - fundify-net
    environment:
      - MONGODB_URI=mongodb://admin:admin@mongodb:27017/test?authSource=admin
      - RPC_URL=http://ethereum:8545
      - NODE_ENV=development
      - CONTRACT_ADDRESS=0x700b6A60ce7EaaEA56F065753d8dcB9653dbAD35
    depends_on:
      - ethereum
      - contract
      - mongodb

  website:
    build:
      context: .
      dockerfile: apps/website/Dockerfile
    ports:
      - "3000:3000"
    networks:
      - fundify-net
    environment:
      - MONGODB_URI=mongodb://admin:admin@mongodb:27017/test?authSource=admin
      - RPC_URL=http://ethereum:8545
      - NODE_ENV=development
      - CONTRACT_ADDRESS=0x700b6A60ce7EaaEA56F065753d8dcB9653dbAD35
    depends_on:
      - ethereum
      - contract
      - mongodb
      - indexer

networks:
  fundify-net:
    driver: bridge
